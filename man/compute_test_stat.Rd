% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/test_statistic.R
\name{compute_test_stat}
\alias{compute_test_stat}
\title{Compute Test Statistic T_h^G}
\usage{
compute_test_stat(
  data,
  dag,
  h = "squared",
  h_params = list(),
  qn_result = NULL,
  ordering = NULL,
  bandwidth = NULL
)
}
\arguments{
\item{data}{Numeric matrix with n observations and p variables}

\item{dag}{A dag object specifying the DAG structure}

\item{h}{Test function or name of built-in function ("squared", "poly",
"exp", "indicator"). Default is "squared".}

\item{h_params}{List of parameters for test function (e.g., list(k = 2) for poly)}

\item{qn_result}{Optional pre-computed Q_n result. If NULL, computes Q_n.}

\item{ordering}{Optional topological ordering to use}

\item{bandwidth}{Vector of bandwidths for KDE. If NULL, uses Silverman's rule.}
}
\value{
An object of class "test_stat_result" with components:
\item{statistic}{The test statistic T_h^G}
\item{lhs}{Left-hand side of inequality (observed)}
\item{rhs}{Right-hand side of inequality (bound)}
\item{qn}{Q_n^G value used}
\item{h_name}{Name of test function}
\item{ordering}{Topological ordering used}
\item{n_obs}{Number of observations}
\item{n_vars}{Number of variables}
}
\description{
Computes the test statistic based on Carbery's inequality:
T_h^G = RHS - LHS
where RHS is the bound from the inequality and LHS is the observed value.
}
\details{
The test statistic is:
\deqn{T_h^G = Q_n \cdot \prod_{j=1}^n (E[h_j(X_j)^{n+1}])^{1/(n+1)} -
             E\left[\prod_{j=1}^n h_j(X_j) \cdot p_j(X_j)^{1/(n+1)}\right]}

Under H_0 (data consistent with DAG), T_h^G >= 0 with high probability.
Large negative values suggest violation of the DAG structure.
}
\examples{
# Create chain DAG and generate data
A <- matrix(c(0, 1, 0, 0, 0, 1, 0, 0, 0), 3, 3, byrow = TRUE)
g <- dag(A, nodes = c("X1", "X2", "X3"))

set.seed(123)
X1 <- rnorm(200)
X2 <- 0.5 * X1 + rnorm(200, sd = 0.5)
X3 <- 0.5 * X2 + rnorm(200, sd = 0.5)
data <- cbind(X1, X2, X3)

# Compute test statistic
result <- compute_test_stat(data, g)

}
